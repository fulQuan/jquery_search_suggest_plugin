!window.jQuery&&document.writeln("<script src=\"http://code.jquery.com/jquery-1.11.0.min.js?ver=1.11.0\"></script>");(function($){$.event.special.textchange={setup:function(data,namespaces){$(this).attr('lastValue',this.contentEditable==='true'?$(this).html():$(this).val());$(this).bind('keyup.textchange',$.event.special.textchange.handler);$(this).bind('cut.textchange paste.textchange input.textchange',$.event.special.textchange.delayedHandler)},teardown:function(namespaces){$(this).unbind('.textchange')},handler:function(event){$.event.special.textchange.triggerIfChanged($(this))},delayedHandler:function(event){var element=$(this);setTimeout(function(){$.event.special.textchange.triggerIfChanged(element)},25)},triggerIfChanged:function(element){var current=element[0].contentEditable==='true'?element.html():element.val();if(current!==element.attr('lastValue')){element.trigger('textchange',element.attr('lastValue'),current).attr('lastValue',current)}}};$.fn.searchSuggest=function(opts){if(typeof opts=='string'&&methods[opts]){return methods[opts].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof opts==='object'||!opts){return methods.init.apply(this,arguments)}};var methods={init:function(opts){var handleError=function(error){showError("url错误或超时，请求失败!")};var showError=function(error){console.log(error)};var render=function(parent,json,ddiv,opts){var res=json['data']||json;var appendStr='<div class="content">';for(var i=0;i<res.length;i+=1){appendStr+=opts.tpl.replace(/\{([a-z]+)\}/ig,function(m,n){return res[i][n]})}appendStr+='</div><div class="description">'+opts.json.defaults+'</div>';jebind(parent,appendStr,ddiv,opts)};var setDescription=function(ddiv,opts){var ddiv=ddiv||dropDiv;var opts=opts||options;if(ddiv.html()==''){ddiv.hide();return}var desc=ddiv.find('.description');if(opts.style=='list'){desc.hide();ddiv.find('.content').css({'width':'100%','border':'0'});ddiv.find('.content .list .word').css({'width':"49%"});ddiv.find('.desc').show();return}else if(opts.style=='line'){desc.hide();ddiv.find('.desc').hide();ddiv.find('.content').css({'width':'100%','border':'0'});return}var selectedList=ddiv.find('.'+opts.listHoverCSS);if(selectedList.length>0){var rel_id=selectedList.find('.word').attr('rel_id').split('_');var index=rel_id[rel_id.length-1];var de=opts.json.data[index].description}else{var de=opts.json.defaults}desc.html(de)};var jebind=function(parent,a,ddiv,opts){var ddiv=ddiv||dropDiv,opts=opts||options;ddiv.append(a);setDescription(ddiv,opts);ddiv.find('.list').each(function(){$(this).unbind('mouseover').mouseover(function(){unHoverAll(ddiv,opts);$(this).addClass(opts.listHoverCSS);setDescription(ddiv,opts)}).unbind('click').click(function(){var inputValList;if(opts.multiWord){inputValList=parent.val().split(' ');inputValList[inputValList.length-1]=getPointWord($(this));parent.val(inputValList.join(' '))}else{parent.val(getPointWord($(this)))}parent.focus()})})};var unHoverAll=function(ddiv,opts){var ddiv=ddiv||dropDiv,opts=opts||options;ddiv.find('.'+opts.listHoverCSS).removeClass(opts.listHoverCSS);setDescription(ddiv,opts)};var getPointWord=function(p){return p.find('div:first').text()};var refreshDropDiv=function(parent,json,ddiv,opts){var left,height,top,width,ddiv=ddiv||dropDiv,opts=opts||options;json=validData=processData(json);if(!validData||json.data.length==0){ddiv.hide();return false}left=parent.offset().left;height=parent.height();top=parent.offset().top+opts.topoffset+height;width=opts.width||parent.width()+'px';ddiv.empty();ddiv.css({'left':left,'top':top,'width':width});render(parent,json,ddiv,opts);parent.focus();ddiv.fadeIn(500)};var getData=function(word,parent,callback,ddiv,opts){var json,validData,ddiv=ddiv||dropDiv,opts=opts||options;console.log(opts.url+word);if(opts.url!=null){var hyphen=opts.url.indexOf('?')!=-1?'&':"?";var URL=opts.jsonp?[opts.url+word,hyphen,opts.jsonp,'=?'].join(''):opts.url+word;$.ajax({type:'GET',url:URL,dataType:'json',timeout:3000,success:function(data){callback(parent,data,ddiv,opts)},error:handleError})}else{json=opts.json;validData=checkData(json);if(validData&&$.trim(word)!=''){var jsonStr="{'data':[";for(var i=json.data.length-1;i>=0;i--){if(json.data[i].word.indexOf(word)!=-1||word.indexOf(json.data[i].word)!=-1){jsonStr+="{'id':'"+json.data[i].id+"','word':'"+json.data[i].word+"', 'description': '"+json.data[i].description+"'},"}};jsonStr+="],'defaults':'"+json.defaults+"'}";json=(new Function("return "+jsonStr))();console.log(json)}callback(parent,json,ddiv,opts)}return};var processData=function(json){return validData=checkData(json)};var checkData=function(json){var isEmpty=true;for(var o in json){if(o=='data')isEmpty=false}if(isEmpty){showError("返回数据格式错误!");return false}if(json['data'].length==0){showError("返回数据为空!");return false}return json};var loadCssFlie=function(filename){var linkList=document.getElementsByTagName('link');for(var i=linkList.length-1;i>=0;i--){if(linkList[i].href.indexOf(filename)!=-1){return}};var fileref=document.createElement('link');fileref.setAttribute('rel','stylesheet');fileref.setAttribute('type','text/css');fileref.setAttribute('href',filename);document.getElementsByTagName('head')[0].appendChild(fileref)};var options=$.extend({url:null,jsonp:null,json:{'data':[{'id':'0','word':'lzw.me','description':'http://lzw.me'},{'id':'1','word':'w1.lzw.me','description':'http://w1.lzw.me'}],'defaults':'http://lzw.me'},style:'default',cssFile:'/our/css/search-suggest.css',dropDivClassName:'search-suggest',listHoverCSS:'jhover',tpl:'<div class="list"><div class="word" rel_id="st_{id}">{word}</div><div class="desc">{description}</div></div>',multiWord:false,processData:processData,getData:getData,topoffset:5,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13},opts);options.json.defaults=options.json.defaults||'';if($.isFunction(options.processData)){processData=options.processData}if($.isFunction(options.getData)){getData=options.getData}var data=this.data('searchsuggest');if(data){return this}this.data('searchsuggest',{target:this,options:options});loadCssFlie(options.cssFile);var dropDiv=$('<div class="'+options.dropDivClassName+'"></div>').appendTo('body');var isOver=false;dropDiv.hover(function(){isOver=true},function(){isOver=false});return this.each(function(){var $this=$(this);$(this).bind('keydown',function(event){if(dropDiv.css('display')!='none'){var currentList=dropDiv.find('.'+options.listHoverCSS),tipsWord='';if(event.keyCode==options.keyDown){if(currentList.length==0){tipsWord=getPointWord(dropDiv.find('.list:first').mouseover())}else if(currentList.next().length==0){unHoverAll(dropDiv,options);$(this).val($(this).attr('alt'))}else{unHoverAll(dropDiv,options);if(currentList.next().length!=0)tipsWord=getPointWord(currentList.next().mouseover())}}else if(event.keyCode==options.keyUp){if(currentList.length==0){tipsWord=getPointWord(dropDiv.find('.list:last').mouseover())}else if(currentList.prev().length==0){unHoverAll(dropDiv,options);$(this).val($(this).attr('alt'))}else{unHoverAll(dropDiv,options);if(currentList.prev().length!=0)tipsWord=getPointWord(currentList.prev().mouseover())}}else if(event.keyCode==options.keyEnter)dropDiv.empty().hide();if(tipsWord!=''){if(opts.multiWord){var inputVal=$(this).val();var inputValList=inputVal.split(' ');inputValList[inputValList.length-1]=tipsWord;$(this).val(inputValList.join(' '))}else{$(this).val(tipsWord)}return false}}$(this).attr('alt',$(this).val())}).bind('keyup',function(event){var word,words;if(event.keyCode==options.keyDown||event.keyCode==options.keyUp)return;word=$(this).val();if($.trim(word)!=''&&word==$(this).attr('alt'))return;if(opts.multiWord){words=word.split(' ');word=words[words.length-1]}getData($.trim(word),$this,refreshDropDiv,dropDiv,options)}).bind('blur',function(){if(isOver&&dropDiv.find('.'+options.listHoverCSS)!=0)return;dropDiv.empty().hide()}).bind('click',function(){var word,words;word=$(this).val();if($.trim(word)!=''&&word==$(this).attr('alt')||dropDiv.css('display')!='none')return;if(opts.multiWord){words=word.split(' ');word=words[words.length-1]}getData($.trim(word),$this,refreshDropDiv,dropDiv,options)})})},show:function(){var data=this.data('searchsuggest');if(data&&data.options){$("."+data.options.dropDivClassName).show()};return this},hide:function(){var data=this.data('searchsuggest');if(data&&data.options){$("."+data.options.dropDivClassName).hide()};return this},destroy:function(){var data=this.data('searchsuggest');if(data&&data.options){$("."+data.options.dropDivClassName).remove()};return this.each(function(){$(this).unbind()})}}})(jQuery);